<!doctype html>
<html>
  <head>
    <title>Subscriber Stream Manager Test</title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <meta content="width=device-width, initial-scale=1, user-scalable=no" name="viewport">
    <script src="../../lib/webrtc/adapter.js"></script>
    <script src="../../lib/videojs/video.min.js"></script>
    <script src="../../lib/videojs/videojs-media-sources.min.js"></script>
    <script src="../../lib/videojs/videojs.hls.min.js"></script>
    <script src="../../script/testbed-config.js"></script>
    <script src="../../script/red5pro-utils.js"></script>
    <link rel="stylesheet" href="../../lib/videojs/video-js.min.css">
    <link rel="stylesheet" href="../../css/reset.css">
    <link rel="stylesheet" href="../../css/testbed.css">
  </head>
  <body>
    <div id="app">
      <p class="version-field">Testbed Version: 2.0.8&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://red5pro.github.io/red5pro-html-sdk-testbed/red5pro-html-testbed-latest.zip">download</a></p>
      <div id="back-link-container" style="text-align: left;"><p id="back-link"><a href="../../index.html">&lt; Settings</a></p></div>
      <div class="test-notification">
        <p>In order to properly run the Stream Manager examples, you will need to configure you server for cluster infrastructure as described in the following documentation:</p>
        <p><a href="https://www.red5pro.com/docs/server/autoscale/" target="_blank">https://www.red5pro.com/docs/server/autoscale/</a></p>
      </div>
      <h1 class="centered">Subscriber Stream Manager Test</h1>
      <hr />
      <h2 class="centered"><em>stream</em>: <span id="stream-title"></span></h2>
      <p id="status-field" class="centered status-field">On hold.</p>
      <script>
        (function (window, document) {
          'use strict';
      
          var statusField = document.getElementById('status-field');
      
          // Displays in status field based on events from subscriber instance.
          function updateStatusFromEvent (event, field) {
            var subTypes = window.red5prosdk.SubscriberEventTypes;
            var rtcTypes = window.red5prosdk.RTCSubscriberEventTypes;
            var status;
            var answer;
            var candidate;
            switch (event.type) {
              case subTypes.CONNECT_SUCCESS:
                status = 'Connection established...';
                break;
              case subTypes.CONNECT_FAILURE:
                status = 'Error - Could not establish connection.';
                break;
              case subTypes.SUBSCRIBE_START:
                status = 'Started subscribing session.';
                break;
              case subTypes.SUBSCRIBE_FAIL:
                status = 'Error - Could not start a subscribing session.';
                break;
              case subTypes.SUBSCRIBE_INVALID_NAME:
                status = 'Error - Stream name not in use.';
                break;
              case rtcTypes.OFFER_START:
                status = 'Begin offer...';
                break;
              case rtcTypes.OFFER_END:
                status = 'Offer accepted...';
                break;
              case rtcTypes.ANSWER_START:
                status = 'Sending answer...';
                answer = JSON.stringify(event.data, null, 2);
                console.log('[SubscriberStatus] ' + event.type + ': ' + answer);
                break;
              case rtcTypes.ANSWER_END:
                status = 'Answer received...';
                break;
              case rtcTypes.CANDIDATE_START:
                status = 'Sending candidate...';
                candidate = JSON.stringify(event.data, null, 2);
                console.log('[SubscriberStatus] ' + event.type + ': ' + candidate);
                break;
              case rtcTypes.CANDIDATE_END:
                status = 'Candidate received...';
                break;
              case rtcTypes.ICE_TRICKLE_COMPLETE:
                status = 'Negotiation complete. Waiting Subscription Start...';
                break;
          }
          statusField.innerText = ['STATUS', status].join(': ');
        }
      
        window.red5proHandleSubscriberEvent = updateStatusFromEvent;
      
      })(this, document);
      </script>
      <div class="centered">
        <video id="red5pro-subscriber-video" controls class="video-element"></video>
      </div>
    </div>
    <script src="../../lib/es6/es6-promise.min.js"></script>
    <script src="../../lib/es6/es6-bind.js"></script>
    <script src="../../lib/es6/es6-array.js"></script>
    <script src="../../lib/es6/es6-object-assign.js"></script>
    <script src="../../lib/es6/es6-fetch.js"></script>
    <script src="../../lib/red5pro/red5pro-sdk.min.js"></script>
    <script src="index.js"></script>
  </body>
</html>
